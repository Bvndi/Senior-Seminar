<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Local Business Finder</title>
  <link rel="stylesheet" href="style.css">
  <!-- Add FontAwesome for social media icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <!-- Add Leaflet for maps -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
  <div class="main">
    <div class="navbar">
        <div class="icon">
            <h2 class="logo">B</h2>
        </div>
  <div class="container">
    <h1>Local Business Finder</h1>
    <form id="searchForm">
      <input type="text" id="location" placeholder="Enter location (e.g., New York, NY)" required>
      <input type="text" id="term" placeholder="Search for (e.g., restaurants, plumbers)" required>
      <button type="submit">Search</button>
    </form>
    <div id="results"></div>
  </div>

  <script>
    const searchButton = document.getElementById('searchButton');
    const searchInput = document.getElementById('searchInput');
    const resultsDiv = document.getElementById('results');

    searchButton.addEventListener('click', async () => {
      const query = searchInput.value;
      if (query) {
        try {
          // Clear previous results
          resultsDiv.innerHTML = '<p>Loading...</p>';
          
          // Call your API
          const response = await fetch(`http://localhost:3000/business-info?query=${encodeURIComponent(query)}`);
          const data = await response.json();

          // Display results
          displayResults(data);
        } catch (error) {
          console.error('Error fetching data:', error);
          resultsDiv.innerHTML = '<p>Failed to fetch results. Please try again.</p>';
        }
      } else {
        alert('Please enter a business name or type.');
      }
    });

    function displayResults(data) {
      if (data.error) {
        resultsDiv.innerHTML = `<p>${data.error}</p>`;
        return;
      }

      // Clear previous results
      resultsDiv.innerHTML = '';

      //Create a business card
      const businessCard = document.createElement('div');
      businessCard.className = 'business-card';

      //Add business name
      const businessName = document.createElement('h2');
      businessName.textContent = data.name;
      businessName.appendChild(businessName);

      //Add address
      const address = document.createElement('p');
      address.innerHTML = '<strong>Address:</strong> ${data.location.address}';
      businessCard.appendChild(address);

      // Add map
      const mapContainer = document.createElement('div');
      mapContainer.id = 'map';
      mapContainer.style.height = '200px';
      mapContainer.style.marginBottom = '20px';
      businessCard.appendChild(mapContainer);

      // Initialize the map
      const map = L.map('map').setView([data.location.latitude, data.location.longitude], 15);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
      }).addTo(map);
      L.marker([data.location.latitude, data.location.longitude]).addTo(map);

      // Add online presence
      const onlinePresence = document.createElement('p');
      onlinePresence.innerHTML = `<strong>Online Presence:</strong>`;
      businessCard.appendChild(onlinePresence);

      const linksList = document.createElement('ul');
      data.onlinePresence.forEach(link => {
        const listItem = document.createElement('li');
        const anchor = document.createElement('a');
        anchor.href = link;
        anchor.target = '_blank';

        // Add social media icons
        if (link.includes('facebook.com')) {
          anchor.innerHTML = '<i class="fab fa-facebook"></i> Facebook';
        } else if (link.includes('instagram.com')) {
          anchor.innerHTML = '<i class="fab fa-instagram"></i> Instagram';
        } else if (link.includes('linkedin.com')) {
          anchor.innerHTML = '<i class="fab fa-linkedin"></i> LinkedIn';
        } else {
          anchor.textContent = link;
        }

        listItem.appendChild(anchor);
        linksList.appendChild(listItem);
      });
      businessCard.appendChild(linksList);

      // Append the business card to the results div
      resultsDiv.appendChild(businessCard);
    }
  </script>
</body>
</html>